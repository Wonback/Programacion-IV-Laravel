<app-navbar></app-navbar>

<section class="neo-page neo-page--full checkout-page">
  <div class="neo-wrapper neo-wrapper--narrow">
    <article class="neo-card neo-card--accent checkout-card">
      <header class="neo-card__header">
        <span class="neo-card__eyebrow">Confirmá tu compra</span>
        <h1 class="neo-card__title">Checkout</h1>
        <p class="neo-card__subtitle">
          Revisá los datos del evento y completá la información de pago para obtener tu ticket digital al instante.
        </p>
      </header>

      <section class="checkout-summary">
        <div class="checkout-summary__icon">
          <fa-icon [icon]="faTicketAlt"></fa-icon>
        </div>
        <div class="checkout-summary__content">
          <h2>{{ eventTitle || 'Cargando evento...' }}</h2>
          <p *ngIf="eventTitle">Tu entrada incluye acceso general para una persona.</p>
        </div>
        <div class="checkout-summary__price">
          <span>Total</span>
          <strong>
            <fa-icon [icon]="faDollarSign"></fa-icon>
            {{ price | currency: 'USD' }}
          </strong>
        </div>
      </section>

      <div *ngIf="paymentDone; else paymentForm" class="checkout-success">
        <div class="neo-feedback neo-feedback--success checkout-success__banner">
          <fa-icon [icon]="faCheckCircle"></fa-icon>
          ¡Pago realizado con éxito!
        </div>
        <p class="neo-text--muted">
          Ya podés descargar tu ticket y guardarlo para presentarlo en el ingreso.
        </p>
        <div class="checkout-success__qr">
          <qrcode *ngIf="qrData" [qrdata]="qrData" [width]="180" [errorCorrectionLevel]="'M'"></qrcode>
          <span>{{ qrData }}</span>
        </div>
        <div class="checkout-success__actions">
          <button type="button" class="neo-button neo-button--primary" (click)="downloadQR()">
            <fa-icon [icon]="faDownload"></fa-icon>
            Descargar ticket
          </button>
          <button type="button" class="neo-button neo-button--ghost" (click)="goHome()">
            <fa-icon [icon]="faHome"></fa-icon>
            Volver al inicio
          </button>
        </div>
      </div>

      <ng-template #paymentForm>
        <form (ngSubmit)="processPayment()" class="neo-form checkout-form">
          <div class="checkout-form__row">
            <label class="neo-field neo-field--full">
              <span>Correo asociado</span>
              <div class="neo-field__control">
                <fa-icon [icon]="faEnvelope" class="neo-field__icon"></fa-icon>
                <input type="email" placeholder="tucorreo@ejemplo.com" [value]="userEmail" disabled />
              </div>
            </label>
          </div>

          <div class="checkout-form__row">
            <label class="neo-field neo-field--full">
              <span>Número de tarjeta</span>
              <div class="neo-field__control checkout-card-number">
                <fa-icon [icon]="faCreditCard" class="neo-field__icon"></fa-icon>
                <input
                  type="text"
                  maxlength="19"
                  name="cardNumber"
                  [(ngModel)]="cardNumber"
                  (input)="formatCardNumber()"
                  placeholder="XXXX XXXX XXXX XXXX"
                  required
                />
              </div>
            </label>
          </div>

          <div class="checkout-form__row">
            <label class="neo-field neo-field--full">
              <span>Titular de la tarjeta</span>
              <div class="neo-field__control">
                <fa-icon [icon]="faUserShield" class="neo-field__icon"></fa-icon>
                <input
                  type="text"
                  name="cardHolder"
                  [(ngModel)]="cardHolder"
                  placeholder="Nombre como figura en la tarjeta"
                  required
                />
              </div>
            </label>
          </div>

          <div class="checkout-form__row checkout-form__row--split">
            <label class="neo-field">
              <span>Vencimiento</span>
              <div class="neo-field__control">
                <input
                  type="text"
                  name="expiration"
                  maxlength="5"
                  [(ngModel)]="expiration"
                  placeholder="MM/AA"
                  required
                />
              </div>
            </label>

            <label class="neo-field">
              <span>CVV</span>
              <div class="neo-field__control">
                <input
                  type="password"
                  name="cvv"
                  maxlength="4"
                  [(ngModel)]="cvv"
                  placeholder="***"
                  required
                />
              </div>
            </label>
          </div>

          <button type="submit" class="neo-button neo-button--primary checkout-form__submit" [disabled]="loading">
            <fa-icon *ngIf="loading" [icon]="faSpinner" [animation]="'spin'" class="checkout-form__spinner"></fa-icon>
            {{ loading ? 'Procesando...' : 'Pagar ahora' }}
          </button>

          <p class="checkout-form__disclaimer">
            <fa-icon [icon]="faUserShield"></fa-icon>
            Transacción segura y encriptada. No almacenamos los datos de tu tarjeta.
          </p>
        </form>
      </ng-template>
    </article>
  </div>
</section>

<app-footer></app-footer>
