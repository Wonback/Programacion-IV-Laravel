<app-navbar></app-navbar>

<div *ngIf="event" class="min-h-screen bg-[#0a0a0a] text-gray-100 flex flex-col">
  <!-- Imagen principal -->
  <div class="relative w-full h-[420px] overflow-hidden">
    <img
      *ngIf="!editMode"
      [src]="event.image_path"
      [alt]="event.title"
      class="w-full h-full object-cover brightness-90 hover:scale-105 transition-transform duration-700"
    />
    <img
      *ngIf="editMode && imagePreview"
      [src]="imagePreview"
      class="w-full h-full object-cover brightness-90 hover:scale-105 transition-transform duration-700"
    />
    <div
      class="absolute inset-0 bg-gradient-to-t from-[#0a0a0a]/90 via-transparent to-transparent"
    ></div>
  </div>

  <!-- Contenido principal -->
  <div class="flex-1 w-full pt-4 max-w-5xl mx-auto space-y-10">

    <!-- Vista normal -->
    <div *ngIf="!editMode" class="text-gray-400 bg-[#0a0a0a] body-font">
      <div class="container mx-auto">
        <div class="flex flex-col text-center w-full mb-10">
          <h1 class="text-4xl font-bold title-font mb-4 text-[#00d58b]">
            {{ event.title }}
          </h1>
          <div
            class="mx-auto mb-4 inline-flex items-center gap-2 rounded-full border px-4 py-1 text-sm uppercase tracking-widest"
            [ngStyle]="{
              borderColor: categoryAccent(event.category),
              color: categoryAccent(event.category),
              background: categoryAccentSoft(event.category)
            }"
          >
            <fa-icon [icon]="faLayerGroup"></fa-icon>
            {{ categoryLabel(event.category) }}
          </div>
          <p class="lg:w-2/3 mx-auto leading-relaxed text-lg">
            {{ event.description }}
          </p>
        </div>

        <div class="flex justify-center -m-4 text-center">
          <div class="p-4 md:w-1/4 sm:w-1/2 w-full">
            <div class="border-2 border-gray-800 px-4 py-6 rounded-lg">
              <fa-icon [icon]="faCalendar" class="text-[#00d58b] text-4xl"></fa-icon>
              <h2 class="title-font font-medium text-3xl text-white">
                {{ event.starts_at | date : 'd MMM y' }}
              </h2>
              <p class="leading-relaxed">Fecha</p>
            </div>
          </div>
          <div class="p-4 md:w-1/4 sm:w-1/2 w-full">
            <div class="border-2 border-gray-800 px-4 py-6 rounded-lg">
              <fa-icon [icon]="faUsers" class="text-[#00d58b] text-4xl mb-3"></fa-icon>
              <h2 class="title-font font-medium text-3xl text-white">{{ event.capacity }}</h2>
              <p class="leading-relaxed">Capacidad</p>
            </div>
          </div>
          <div class="p-4 md:w-1/4 sm:w-1/2 w-full">
            <div class="border-2 border-gray-800 px-4 py-6 rounded-lg">
              <fa-icon [icon]="faMoney" class="text-[#00d58b] text-4xl mb-3"></fa-icon>
              <h2 class="title-font font-medium text-3xl text-white">${{ event.price }}</h2>
              <p class="leading-relaxed">Precio</p>
            </div>
          </div>
          <div class="p-4 md:w-1/4 sm:w-1/2 w-full">
            <div class="border-2 border-gray-800 px-4 py-6 rounded-lg">
              <fa-icon
                [icon]="faLayerGroup"
                class="text-4xl mb-3"
                [ngStyle]="{ color: categoryAccent(event.category) }"
              ></fa-icon>
              <h2 class="title-font font-medium text-2xl text-white">
                {{ categoryLabel(event.category) }}
              </h2>
              <p class="leading-relaxed">Categoría</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón de compra -->
    <div *ngIf="!editMode" class="flex flex-wrap justify-center gap-5">
      <button
        (click)="router.navigate(['/checkout', event.id])"
        class="px-8 py-3 bg-gradient-to-r from-[#00d58b] to-[#92fa87] text-black font-semibold rounded-full hover:opacity-90 transition shadow-lg"
      >
        <fa-icon [icon]="faTicket" class="mr-2"></fa-icon> Comprar Entrada
      </button>
    </div>

    <!-- Vista de edición -->
    <div *ngIf="editMode" class="bg-[#111] p-6 rounded-2xl border border-[#00d58b]/30 shadow-lg space-y-5">
      <h2 class="text-2xl font-semibold text-[#00d58b] text-center mb-4">Editar Evento</h2>

      <form (ngSubmit)="saveEdit(editForm)" #editForm="ngForm" class="space-y-4">
        <input type="text" [(ngModel)]="formData.title" name="title"
          class="w-full p-2 rounded bg-[#0a0a0a] border border-[#00d58b]/30 text-gray-200"
          placeholder="Título del evento" required />

        <textarea [(ngModel)]="formData.description" name="description" rows="4"
          class="w-full p-2 rounded bg-[#0a0a0a] border border-[#00d58b]/30 text-gray-200"
          placeholder="Descripción"></textarea>

        <select [(ngModel)]="formData.category" name="category"
          class="w-full p-2 rounded bg-[#0a0a0a] border border-[#00d58b]/30 text-gray-200"
        >
          <option [ngValue]="null">Seleccioná una categoría</option>
          <option *ngFor="let category of categories" [ngValue]="category.value">{{ category.label }}</option>
        </select>

        <input type="number" [(ngModel)]="formData.capacity" name="capacity"
          class="w-full p-2 rounded bg-[#0a0a0a] border border-[#00d58b]/30 text-gray-200"
          placeholder="Capacidad" required />

        <input type="number" [(ngModel)]="formData.price" name="price"
          class="w-full p-2 rounded bg-[#0a0a0a] border border-[#00d58b]/30 text-gray-200"
          placeholder="Precio" required />

        <input type="file" (change)="onFileChange($event)"
          class="block w-full text-gray-300 border border-[#00d58b]/30 rounded-lg p-2 cursor-pointer bg-[#0a0a0a]" />

        <div class="flex justify-center gap-4 mt-4">
          <button type="submit"
            [disabled]="uploading"
            class="px-6 py-2 bg-[#00d58b] hover:bg-[#92fa87] text-black font-semibold rounded-xl shadow-md transition">
            {{ uploading ? 'Guardando...' : 'Guardar Cambios' }}
          </button>

          <button type="button" (click)="toggleEdit()"
            class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-xl shadow-md transition">
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Controles del autor -->
    <div
      *ngIf="canEdit() && !editMode"
      class="flex flex-wrap justify-center gap-4 pt-10 border-t border-[#00d58b]/20"
    >
      <button
        (click)="toggleEdit()"
        class="px-6 py-2.5 bg-[#00d58b] hover:bg-[#92fa87] text-black font-medium rounded-xl transition shadow-md"
      >
        <fa-icon [icon]="faPen" class="mr-2"></fa-icon> Editar
      </button>
      <button
        (click)="deleteEvent()"
        class="px-6 py-2.5 bg-red-600 hover:bg-red-700 rounded-xl text-white font-medium shadow-md transition"
      >
        <fa-icon [icon]="faTrash" class="mr-2"></fa-icon> Cancelar Evento
      </button>
    </div>
  </div>
</div>
