<app-navbar></app-navbar>

<section class="neo-page neo-page--with-nav tickets-page">
  <div class="neo-wrapper">
    <header class="neo-hero tickets-hero">
      <span class="neo-card__eyebrow">Tus accesos digitales</span>
      <h1 class="neo-hero__title">Mis tickets</h1>
      <p class="neo-hero__subtitle">
        Revisá tus compras recientes, descargá los códigos QR y mantené toda la información de tus eventos en un solo lugar.
      </p>
    </header>

    <ng-container *ngIf="!loading; else loadingTpl">
      <div *ngIf="myEvents.length > 0; else emptyTpl" class="neo-grid tickets-grid">
        <article class="neo-card tickets-card" *ngFor="let e of myEvents">
          <header class="tickets-card__header">
            <span
              class="tickets-card__badge"
              *ngIf="e.category"
              [style.border-color]="categoryAccent(e.category)"
              [style.background]="categoryAccentSoft(e.category)"
              [style.color]="categoryAccent(e.category)"
            >
              <fa-icon [icon]="faTicketAlt"></fa-icon>
              {{ categoryLabel(e.category) }}
            </span>
            <h2 class="tickets-card__title">{{ e.title }}</h2>
            <p class="tickets-card__description" *ngIf="e.description">{{ e.description }}</p>
          </header>

          <div class="tickets-card__qr">
            <qrcode
              [qrdata]="e.qrData"
              [width]="168"
              [errorCorrectionLevel]="'M'"
              [id]="'qr-' + e.orderId"
            ></qrcode>
            <span class="tickets-card__qr-label">Código: {{ e.orderId }}</span>
          </div>

          <dl class="tickets-card__meta">
            <div class="tickets-card__meta-item">
              <fa-icon [icon]="faCalendar"></fa-icon>
              <div>
                <dt>Fecha del evento</dt>
                <dd>{{ e.starts_at | date: 'dd/MM/yyyy HH:mm' }}</dd>
              </div>
            </div>
            <div class="tickets-card__meta-item">
              <fa-icon [icon]="faDollarSign"></fa-icon>
              <div>
                <dt>Precio unitario</dt>
                <dd>${{ e.price }}</dd>
              </div>
            </div>
            <div class="tickets-card__meta-item">
              <fa-icon [icon]="faTicketAlt"></fa-icon>
              <div>
                <dt>Cantidad</dt>
                <dd>{{ e.quantity || 1 }}</dd>
              </div>
            </div>
            <div class="tickets-card__meta-item">
              <fa-icon [icon]="faFingerprint"></fa-icon>
              <div>
                <dt>Identificador</dt>
                <dd>{{ e.qrData }}</dd>
              </div>
            </div>
          </dl>

          <div class="tickets-card__actions">
            <button type="button" class="neo-button neo-button--primary" (click)="downloadQR(e.orderId)">
              <fa-icon [icon]="faDownload"></fa-icon>
              Descargar ticket
            </button>
            <span class="neo-text--muted">Guardalo en tu wallet o presentalo en la entrada.</span>
          </div>
        </article>
      </div>
    </ng-container>

    <ng-template #loadingTpl>
      <article class="neo-card tickets-state">
        <div class="tickets-state__loader"></div>
        <p class="neo-text--muted">Cargando tus tickets...</p>
      </article>
    </ng-template>

    <ng-template #emptyTpl>
      <article class="neo-card tickets-state">
        <div class="neo-feedback neo-feedback--info">
          Todavía no compraste entradas. Explorá la cartelera y elegí tu próximo evento.
        </div>
        <button type="button" class="neo-button neo-button--ghost" routerLink="/home">
          Descubrir eventos
        </button>
      </article>
    </ng-template>
  </div>
</section>

<app-footer></app-footer>
